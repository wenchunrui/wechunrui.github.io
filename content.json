[{"title":"图像处理","date":"2020-06-01T13:20:01.920Z","path":"2020/06/01/图像处理/","text":"图像处理 学前了解 在php中通过GD库处理图像函数的操作,都是先在内存中处理,错做完成以后再以文件流的方式,输出到浏览器或者保存在返屋企的磁盘中. 学前需求 开启GD库扩展 创建一个图像应该完成如下所示的几个基本步骤 创建图像:所有的绘图设计都需要在一个图像上完成，以后操作都基于这个图像。 绘制图像：图像创建完成以后，就可以通过这个图像资源，使用各种画像函数设置图像的颜色、填充画布、画点、线段、各种几何图形，以及向图像的添加文本等。 生成图像：完成整个图像的绘制之后，需要将图像以某种格式保存到服务器的文件中，或者将图像直接输出到浏览器上显示给用户。但在图像输出之前，一定要使用header()函数发送Content-type通知浏览器，这次发送的是图片不是文本 释放资源 创建图像 绘制图像 生成图像 header();函数注意点：在该函数之前不能输出任何内容 释放资源 图形验证码 水印 缩放与裁剪 验证码例子 123456789101112131415161718192021222324header('Content-type: image/jpeg');$width = 120;$height = 40;$element = array('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z');$string = '';for ($i=0;$i&lt;5;$i++)&#123; $string .= $element[rand(0,count($element)-1)];&#125;$img = imagecreatetruecolor($width,$height);//创建一个图片资源$colorBg = imagecolorallocate($img, rand(200,255), rand(200,255), rand(200,255));//调色$colorBorder = imagecolorallocate($img, rand(200,255), rand(200,255), rand(200,255));$colorString = imagecolorallocate($img, rand(10,100), rand(10,100), rand(10,100));imagefill($img, 0, 0, $colorBg);//背景颜色imagerectangle($img,0,0,$width-1,$height-1,$colorBorder);//画矩形,边框for ($i=0;$i&lt;200;$i++)&#123; imagesetpixel($img, rand(0,$width-1), rand(0,$height-1),imagecolorallocate($img, rand(100,200), rand(100,200), rand(100,200)));//画点&#125;for ($i=0;$i&lt;3;$i++)&#123; imageline($img,rand(0,$width/2),rand(0,$height),rand($width/2,0),rand($height/2,0),imagecolorallocate($img, rand(100,200), rand(100,200), rand(100,200)));//画线&#125;//imagestring($img,5,0,0,'abcd',$colorString);//添加文本内容imagettftext($img, 48, rand(-10,10),rand(12,20),rand(28,32),$colorString,'font/Self-Deception-2.ttf',$string);//添加文本内容,可以修改字体大小,更换字体imagejpeg($img);//输出给浏览器imagedestroy($img);//释放资源 添加文字水印例子 12345678910header('Content-type: image/jpeg');$img = imagecreatefromjpeg('images/timg.jpeg');//获取本地图片或线上图片,线上图片填写url$color = imagecolorallocate($img,255,255,255);//调色$width = imagesx($img);//获取图片资源的宽度$height = imagesy($img);//获取图片资源的高度$position = imagettfbbox(20,0,'font/hjt.ttf','锐');//获取字体的8个基点,分别为左下角 X 位置/左下角 Y 位置/右下角 X 位置/右下角 Y 位置/右上角 X 位置/右上角 Y 位置/左上角 X 位置/左上角 Y 位置以数组的方式返回$stringWidth = $position[2]-$position[0];//用右下角 X 位置-左下角 X 位置获取字符串的长度imagettftext($img,50,0,$width-1-$stringWidth-($width/30),$height-1-($height/30),$color,'font/hjt.ttf','锐');//添加文本水印imagejpeg($img);//发送给浏览器imagedestroy($img);//释放资源 imagecopy 123456789101112131415161718192021222324header('Content-type: image/jpeg');$img = imagecreatefromjpeg('images/timg.jpeg');//获取本地图片或线上图片,线上图片填写url$waterMark = imagecreatefrompng('images/xiao.png');$color = imagecolorallocate($img,255,255,255);//调色$width = imagesx($img);//获取图片资源的宽度$height = imagesy($img);//获取图片资源的高度$waterMarkWidth = imagesx($waterMark);//获取图片资源的宽度$waterMarkHeight = imagesy($waterMark);//获取图片资源的高度$position = imagettfbbox(20,0,'font/hjt.ttf','锐');//获取字体的8个基点,分别为左下角 X 位置/左下角 Y 位置/右下角 X 位置/右下角 Y 位置/右上角 X 位置/右上角 Y 位置/左上角 X 位置/左上角 Y 位置以数组的方式返回$stringWidth = $position[2]-$position[0];//用右下角 X 位置-左下角 X 位置获取字符串的长度/* * 参数说明: * $img:目标图像资源; * $waterMark:水印图片资源; * 100:所要拷贝到目标图像资源上面的坐标(x轴坐标); * 100:所要拷贝到目标图像资源上面的坐标(y轴坐标); * 0:从水印的图像资源的x坐标为0的位置开始拷贝; * 0:从水印的图像资源的y坐标为0的位置开始拷贝; * $waterMarkWidth:所要拷贝的水印图像的长度; * $waterMarkHeight:所要拷贝的水印图像的长度; * */imagecopy($img,$waterMark,100,100,0,0,$waterMarkWidth,$waterMarkHeight);imagejpeg($img);//发送给浏览器imagedestroy($img);//释放资源 imagecopymerge() 12345678910111213141516171819202122232425header('Content-type: image/jpeg');$img = imagecreatefromjpeg('images/timg.jpeg');//获取本地图片或线上图片,线上图片填写url$waterMark = imagecreatefrompng('images/xiao.png');$color = imagecolorallocate($img,255,255,255);//调色$width = imagesx($img);//获取图片资源的宽度$height = imagesy($img);//获取图片资源的高度$waterMarkWidth = imagesx($waterMark);//获取图片资源的宽度$waterMarkHeight = imagesy($waterMark);//获取图片资源的高度$position = imagettfbbox(20,0,'font/hjt.ttf','锐');//获取字体的8个基点,分别为左下角 X 位置/左下角 Y 位置/右下角 X 位置/右下角 Y 位置/右上角 X 位置/右上角 Y 位置/左上角 X 位置/左上角 Y 位置以数组的方式返回$stringWidth = $position[2]-$position[0];//用右下角 X 位置-左下角 X 位置获取字符串的长度/* * 参数说明: * $img:目标图像资源; * $waterMark:水印图片资源; * 100:所要拷贝到目标图像资源上面的坐标(x轴坐标); * 100:所要拷贝到目标图像资源上面的坐标(y轴坐标); * 0:从水印的图像资源的x坐标为0的位置开始拷贝; * 0:从水印的图像资源的y坐标为0的位置开始拷贝; * $waterMarkWidth:所要拷贝的水印图像的长度; * $waterMarkHeight:所要拷贝的水印图像的长度; * 0:水印图片透明度,数值越小越透明,100相当于未改变; * */imagecopymerge($img,$waterMark,100,100,0,0,$waterMarkWidth,$waterMarkHeight,50);imagejpeg($img);//发送给浏览器imagedestroy($img);//释放资源 imagecopyresampled 123456789101112131415161718192021222324header('Content-type: image/jpeg');$img = imagecreatefromjpeg('images/timg.jpeg');$width = 100;$imgWidth = imagesx($img);$imgHeight = imagesy($img);$height = $width/($imgWidth/$imgHeight);$ima1 = imagecreatetruecolor($width,$height);/* * imagecopyresampled()函数每个参数讲解 * dst_image.目标函数资源 * src_image.源图像资源(你要采样的那个图像资源) * dst_x. * dst_y.与上面的dst_x确定了一个坐标,把采样到得部分放到目标图像资源的什么位置 * src_x. * src_y.与上面的src_y确定了一个左边,你要采样的原图像资源的某个部分的起始坐标 * dst_w. * dst_y.与上面的dst_w确定了放到目标图像资源上面的尺寸 * src_w. * src_h.与上面的src_w确定了采样原图像资源的某个部分尺寸 * */imagecopyresampled($ima1,$img,0,0,0,0,$width,$height,$width,$height);imagejpeg($ima1);imagedestroy($ima1);","tags":[]}]